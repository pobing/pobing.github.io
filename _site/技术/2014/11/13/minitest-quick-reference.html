<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Minitest Quick Reference</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">
        <link rel="stylesheet" href="/css/layout.css">

        <!-- google cse -->
        <script type="text/javascript" src="/javascript/google.cse.js"></script>

    </head>
    <body>

        <div class="site">

          <div class="header">
            <h1 class="title"><a href="/">Pobing's Blog</a></h1>
            <a class="extra" href="/">首页</a>
            <a class="extra" href="/page/read.html">阅读</a>
            <a class="extra" href="/feed.xml">Rss</a>

           <gcse:search></gcse:search>


          </div>

          <h2>Minitest Quick Reference</h2>
<p class="meta">13 Nov 2014
<!--   |
 -->
</p>

<div class="post">
<p>source by: <a href="http://www.mattsears.com/articles/2011/12/10/minitest-quick-reference">http://www.mattsears.com/articles/2011/12/10/minitest-quick-reference</a></p>

<p>UPDATE: I&#39;ve added a new section on stubbing with MiniTest and a few helpful comments to the code samples.</p>

<p>MiniTest, as the name suggests, is a small and fast unit testing framework. Shipped with Ruby 1.9, MiniTest supports a complete suite of testing capabilities such as TDD, BDD, mocking, and benchmarking.</p>

<p>This quick reference aims to demonstrate MiniTest&#39;s main concepts and provide real world examples to get you acquainted quickly. Let&#39;s start with MiniTest::Spec.</p>

<h3>MiniTest::Spec</h3>

<p>Provides RSpec-like matchers and contexts right out of the box.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;minitest/autorun&#39;</span>

<span class="n">describe</span> <span class="no">Hipster</span><span class="p">,</span> <span class="s2">&quot;Demonstration of MiniTest&quot;</span> <span class="k">do</span>

  <span class="c1"># Runs codes before each expectation</span>
  <span class="n">before</span> <span class="k">do</span>
    <span class="vi">@hipster</span> <span class="o">=</span> <span class="no">Hipster</span><span class="o">.</span><span class="n">new</span>
  <span class="k">end</span>

  <span class="c1"># Runs code after each expectation</span>
  <span class="n">after</span> <span class="k">do</span>
    <span class="vi">@hipster</span><span class="o">.</span><span class="n">destroy!</span>
  <span class="k">end</span>

  <span class="c1"># Define accessors - lazily runs code when it&#39;s first used</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:hipster</span><span class="p">)</span> <span class="p">{</span> <span class="no">Hipster</span><span class="o">.</span><span class="n">new</span><span class="p">}</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:traits</span><span class="p">)</span> <span class="p">{</span> <span class="o">[</span><span class="s2">&quot;silly hats&quot;</span><span class="p">,</span> <span class="s2">&quot;skinny jeans&quot;</span><span class="o">]</span> <span class="p">}</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:labels</span><span class="p">)</span> <span class="p">{</span> <span class="nb">Array</span><span class="o">.</span><span class="n">new</span> <span class="p">}</span>

  <span class="c1"># Even lazier accessor - assigns `subject` as the name for us</span>
  <span class="c1"># this equivalent to let(:subject) { Hipster.new }</span>
  <span class="n">subject</span> <span class="p">{</span> <span class="no">Hipster</span><span class="o">.</span><span class="n">new</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s2">&quot;#define&quot;</span> <span class="k">do</span>
    <span class="n">hipster</span><span class="o">.</span><span class="n">define</span><span class="o">.</span><span class="n">must_equal</span> <span class="s2">&quot;you wouldn&#39;t understand&quot;</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">&quot;#walk?&quot;</span> <span class="k">do</span>
    <span class="n">skip</span> <span class="s2">&quot;I prefer to skip&quot;</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;when asked about the font&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should be helvetica&quot;</span> <span class="k">do</span>
      <span class="vi">@hipster</span><span class="o">.</span><span class="n">preferred_font</span><span class="o">.</span><span class="n">must_equal</span> <span class="s2">&quot;helvetica&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;when asked about mainstream&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;won&#39;t be mainstream&quot;</span> <span class="k">do</span>
      <span class="vi">@hipster</span><span class="o">.</span><span class="n">mainstream?</span><span class="o">.</span><span class="n">wont_equal</span> <span class="kp">true</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Matchers (must | wont)</h3>

<p>In most cases you can switch between must for positive expectations and wont for negative expectations.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="no">Assertion</span> <span class="no">Examples</span>

<span class="n">must_be</span> <span class="n">labels</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">must_be</span> <span class="ss">:==</span><span class="p">,</span> <span class="mi">0</span>

<span class="n">must_be_close_to</span>  <span class="n">traits</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">must_be_close_to</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span>

<span class="n">must_be_empty</span> <span class="n">labels</span><span class="o">.</span><span class="n">must_be_empty</span>

<span class="n">must_be_instance_of</span> <span class="n">hipster</span><span class="o">.</span><span class="n">must_be_instance_of</span> <span class="no">Hipster</span>

<span class="n">must_be_kind_of</span> <span class="n">labels</span><span class="o">.</span><span class="n">must_be_kind_of</span> <span class="no">Enumerable</span>

<span class="n">must_be_nil</span> <span class="n">labels</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">must_be_nil</span>

<span class="n">must_be_same_as</span> <span class="n">traits</span><span class="o">.</span><span class="n">must_be_same_as</span> <span class="n">traits</span>

<span class="n">must_be_silent</span>  <span class="nb">proc</span> <span class="p">{</span> <span class="s2">&quot;no stdout or stderr&quot;</span> <span class="p">}</span><span class="o">.</span><span class="n">must_be_silent</span>

<span class="n">must_be_within_epsilon</span>  <span class="n">traits</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">must_be_within_epsilon</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span>

<span class="n">must_equal</span>  <span class="n">traits</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">must_equal</span> <span class="mi">2</span>

<span class="n">must_include</span>  <span class="n">traits</span><span class="o">.</span><span class="n">must_include</span> <span class="s2">&quot;skinny jeans&quot;</span>

<span class="n">must_match</span>  <span class="n">traits</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">must_match</span> <span class="sr">/silly/</span>

<span class="n">must_output</span> <span class="nb">proc</span> <span class="p">{</span> <span class="nb">print</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">traits</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">!&quot;</span> <span class="p">}</span><span class="o">.</span><span class="n">must_output</span> <span class="s2">&quot;2!&quot;</span>

<span class="n">must_respond_to</span> <span class="n">traits</span><span class="o">.</span><span class="n">must_respond_to</span> <span class="ss">:count</span>

<span class="n">must_raise</span>  <span class="nb">proc</span> <span class="p">{</span> <span class="n">traits</span><span class="o">.</span><span class="n">foo</span> <span class="p">}</span><span class="o">.</span><span class="n">must_raise</span> <span class="no">NoMethodError</span>

<span class="n">must_send</span> <span class="n">traits</span><span class="o">.</span><span class="n">must_send</span> <span class="o">[</span><span class="n">traits</span><span class="p">,</span> <span class="ss">:values_at</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span>

<span class="n">must_throw</span>  <span class="nb">proc</span> <span class="p">{</span> <span class="kp">throw</span> <span class="no">Exception</span> <span class="k">if</span> <span class="n">traits</span><span class="o">.</span><span class="n">any?</span> <span class="p">}</span><span class="o">.</span><span class="n">must_throw</span> <span class="no">Exception</span>
</code></pre></div>
<h3>MiniTest::Unit::TestCase</h3>

<p>Provides a rich set of assertions to make your tests clean and readable.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;minitest/autorun&#39;</span>

<span class="k">class</span> <span class="nc">TestHipster</span> <span class="o">&lt;</span> <span class="no">MiniTest</span><span class="o">::</span><span class="no">Unit</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="k">def</span> <span class="nf">setup</span>
    <span class="vi">@hipster</span> <span class="o">=</span> <span class="no">Hipster</span><span class="o">.</span><span class="n">new</span>
    <span class="vi">@labels</span>  <span class="o">=</span> <span class="nb">Array</span><span class="o">.</span><span class="n">new</span>
    <span class="vi">@traits</span>  <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;silly hats&quot;</span><span class="p">,</span> <span class="s2">&quot;skinny jeans&quot;</span><span class="o">]</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">teardown</span>
    <span class="vi">@hipster</span><span class="o">.</span><span class="n">destroy!</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">test_for_helvetica_font</span>
    <span class="n">assert_equal</span> <span class="s2">&quot;helvetica!&quot;</span><span class="p">,</span> <span class="vi">@hipster</span><span class="o">.</span><span class="n">preferred_font</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">test_not_mainstream</span>
    <span class="n">refute</span> <span class="vi">@hipster</span><span class="o">.</span><span class="n">mainstream?</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Assertions (assert | refute)</h3>

<p>Toggle between assert for positive assertions and refute for negative assertions.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="no">Assertion</span> <span class="no">Example</span>

<span class="n">assert</span>  <span class="n">assert</span> <span class="vi">@traits</span><span class="o">.</span><span class="n">any?</span><span class="p">,</span> <span class="s2">&quot;empty subjects&quot;</span>

<span class="n">assert_empty</span>  <span class="n">assert_empty</span> <span class="vi">@labels</span>

<span class="n">assert_equal</span>  <span class="n">assert_equal</span> <span class="mi">2</span><span class="p">,</span> <span class="vi">@traits</span><span class="o">.</span><span class="n">size</span>

<span class="n">assert_in_delta</span> <span class="n">assert_in_delta</span> <span class="vi">@traits</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span>

<span class="n">assert_in_epsilon</span> <span class="n">assert_in_epsilon</span> <span class="vi">@traits</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>

<span class="n">assert_includes</span> <span class="n">assert_includes</span> <span class="vi">@traits</span><span class="p">,</span> <span class="s2">&quot;skinny jeans&quot;</span>

<span class="n">assert_instance_of</span>  <span class="n">assert_instance_of</span> <span class="no">Hipster</span><span class="p">,</span> <span class="vi">@hipster</span>

<span class="n">assert_kind_of</span>  <span class="n">assert_kind_of</span> <span class="no">Enumerable</span><span class="p">,</span> <span class="vi">@labels</span>

<span class="n">assert_match</span>  <span class="n">assert_match</span> <span class="vi">@traits</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="sr">/silly/</span>

<span class="n">assert_nil</span>  <span class="n">assert_nil</span> <span class="vi">@labels</span><span class="o">.</span><span class="n">first</span>

<span class="n">assert_operator</span> <span class="n">assert_operator</span> <span class="vi">@labels</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="ss">:==</span> <span class="p">,</span> <span class="mi">0</span>

<span class="n">assert_output</span> <span class="n">assert_output</span><span class="p">(</span><span class="s2">&quot;Size: 2&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="nb">print</span> <span class="s2">&quot;Size: </span><span class="si">#{</span><span class="vi">@traits</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>

<span class="n">assert_raises</span> <span class="n">assert_raises</span><span class="p">(</span><span class="no">NoMethodError</span><span class="p">)</span> <span class="p">{</span> <span class="vi">@traits</span><span class="o">.</span><span class="n">foo</span> <span class="p">}</span>

<span class="n">assert_respond_to</span> <span class="n">assert_respond_to</span> <span class="vi">@traits</span><span class="p">,</span> <span class="ss">:count</span>

<span class="n">assert_same</span> <span class="n">assert_same</span> <span class="vi">@traits</span><span class="p">,</span> <span class="vi">@traits</span><span class="p">,</span> <span class="s2">&quot;It&#39;s the same object silly&quot;</span>

<span class="n">assert_send</span> <span class="n">assert_send</span> <span class="o">[</span><span class="vi">@traits</span><span class="p">,</span> <span class="ss">:values_at</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span>

<span class="n">assert_silent</span> <span class="n">assert_silent</span> <span class="p">{</span> <span class="s2">&quot;no stdout or stderr&quot;</span> <span class="p">}</span>

<span class="n">assert_throws</span> <span class="n">assert_throws</span><span class="p">(</span><span class="no">Exception</span><span class="p">,</span><span class="s1">&#39;is empty&#39;</span><span class="p">)</span> <span class="p">{</span><span class="kp">throw</span> <span class="no">Exception</span> <span class="k">if</span> <span class="vi">@traits</span><span class="o">.</span><span class="n">any?</span><span class="p">}</span>
</code></pre></div>
<h3>MiniTest#stub</h3>

<p>Minitest provides a simple stub method we can use to return a pre-determined value.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;minitest/autorun&#39;</span>

<span class="n">describe</span> <span class="no">Hipster</span><span class="p">,</span> <span class="s2">&quot;Demonstrates stubbing with Minitest&quot;</span> <span class="k">do</span>

  <span class="n">let</span><span class="p">(</span><span class="ss">:hipster</span><span class="p">)</span> <span class="p">{</span> <span class="no">Hipster</span><span class="o">.</span><span class="n">new</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s2">&quot;trendy if time is now&quot;</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="n">hipster</span><span class="o">.</span><span class="n">trendy?</span> <span class="no">DateTime</span><span class="o">.</span><span class="n">now</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">&quot;it is NOT trendy if 2 weeks has past&quot;</span> <span class="k">do</span>
    <span class="no">DateTime</span><span class="o">.</span><span class="n">stub</span> <span class="ss">:now</span><span class="p">,</span> <span class="p">(</span><span class="no">Date</span><span class="o">.</span><span class="n">today</span><span class="o">.</span><span class="n">to_date</span> <span class="o">-</span> <span class="mi">14</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">refute</span> <span class="n">hipster</span><span class="o">.</span><span class="n">trendy?</span> <span class="no">DateTime</span><span class="o">.</span><span class="n">now</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>MiniTest::Mock</h3>

<p>A simple and clean mock system. There two essential methods at our disposal: expect and verify.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;minitest/autorun&#39;</span>

<span class="c1"># Make all of our Twitter updates hip</span>
<span class="k">class</span> <span class="nc">Twipster</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">twitter</span><span class="p">)</span>
    <span class="vi">@twitter</span> <span class="o">=</span> <span class="n">twitter</span> <span class="c1"># A Twitter API client</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">tweet</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="vi">@twitter</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">message</span><span class="si">}</span><span class="s2"> #lolhipster&quot;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Uses Mock#expect and Mock#verify</span>

<span class="n">describe</span> <span class="no">Twipster</span><span class="p">,</span> <span class="s2">&quot;Make every tweet a hipster tweet.&quot;</span> <span class="k">do</span>
  <span class="n">before</span> <span class="k">do</span>
    <span class="vi">@twitter</span>  <span class="o">=</span> <span class="no">MiniTest</span><span class="o">::</span><span class="no">Mock</span><span class="o">.</span><span class="n">new</span> <span class="c1"># Mock our Twitter API client</span>
  <span class="k">end</span>

  <span class="n">let</span><span class="p">(</span><span class="ss">:twipster</span><span class="p">)</span> <span class="p">{</span> <span class="no">Twipster</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@twitter</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:message</span><span class="p">)</span> <span class="p">{</span> <span class="s2">&quot;Skyrim? Too mainstream.&quot;</span><span class="p">}</span>

  <span class="n">it</span> <span class="s2">&quot;should append a #lolhipster hashtag and update Twitter with our status&quot;</span> <span class="k">do</span>
    <span class="vi">@twitter</span><span class="o">.</span><span class="n">expect</span> <span class="ss">:update</span><span class="p">,</span> <span class="kp">true</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">message</span><span class="si">}</span><span class="s2"> #lolhipster&quot;</span><span class="o">]</span>
    <span class="vi">@twipster</span><span class="o">.</span><span class="n">tweet</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="n">assert</span> <span class="vi">@twitter</span><span class="o">.</span><span class="n">verify</span> <span class="c1"># verifies tweet and hashtag was passed to `@twitter.update`</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Resources</h3>

<ol>
<li><a href="https://github.com/seattlerb/minitest">MiniTest on Github</a></li>
<li><a href="http://docs.seattlerb.org/minitest">MiniTest Rdoc</a></li>
<li><a href="http://metaskills.net/2011/03/26/using-minitest-spec-with-rails">Using MiniTest::Spec with Rails</a></li>
<li><a href="http://www.rubyinside.com/a-minitestspec-tutorial-elegant-spec-style-testing-that-comes-with-ruby-5354.html">Ruby Inside: A MiniTest::Spec Tutorial: Elegant Spec-Style Testing That Comes With Ruby</a></li>
</ol>

</div>
<p>
<a class="bshareDiv" href="http://www.bshare.cn/share">分享按钮</a><script type="text/javascript" charset="utf-8" src="http://static.bshare.cn/b/buttonLite.js#uuid=0bd5d0c2-23dc-45e3-9d1d-1ebffb059419&style=2&textcolor=#000000&bgcolor=none&bp=qqmb,sinaminiblog,qzone,weixin,facebook,twitter&text=分享"></script>
</p>
<!-- disqus comments -->
<!-- <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'pobingsblog'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a> -->
<!-- disques comments end -->
<!-- Duoshuo Comment BEGIN -->
	<div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"pobing"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0]
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- Duoshuo Comment END -->


          <div class="footer">
              <p>
                <a href="https://github.com/pobing">Git hub</a>
                <a href="https://github.com/pobing">Twitter</a>
                <a href="mailto:cn.jdong@gmail.com">Contact</a>
              </p>
          </div>
        </div>
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-47369732-1', 'pobing.info');
          ga('send', 'pageview');

        </script>
    </body>
</html>
