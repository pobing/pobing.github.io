---
layout: post
title:  "Redis 在短信验证码中的运用"
date:   2014-04-20 10:06:00

categories: 技术
---
很多时候都想不到用 [redis](http://redis.io)，这次项目中要做给用户发送手机验证码的功能。
一般发送手机验证码也就是以下步骤：

```
1.用户获取手机验证码
2.服务器生成验证码（一般是 4-6 位数字），调用第三方发短信接口
3.用户收到验证码的短信后，输入验证码提交
4.服务器验证验证码合法性
```
下面详细说说以上步骤注意事项：

```
步骤1：发短信是调用第三方接口，是要花钱的。用户请求一次发短信接口，1 毛钱就出去了。所以不能让用户一直请求，要对步骤 1 进行请求限制。限制条件假如是： 1次/分钟, 3次/小时
步骤2：服务器生成的验证码要和当前用户关联
步骤3：因为发短信会有时间的延迟，用户好久收不到短信怎么办，多长时间可以重新请求发短信
步骤4：验证码多长时间有效，假如10分钟内有效
```

先说传统的解决办法，假如数据库是 Mysql 要实现上述的需求可以实现，因为要对用户的请求次数进行计数，还要判断验证码的有效期，难点就在此，想想就麻烦。
而且验证码是临时性的，其实不需要存储的。
<!-- 创建一个保存验证码的数据表假如叫：codes，codes 表和用户表 users 关联，用户请求发短信的接口，服务端先判断当前时间和该用户的上一次code 记录创建时间只差，如果小于1 ，说明在一分钟内，返回稍后操作的提示，如果大于1，说明在1分钟之外，则codes 表新增一记录，然后发短信， -->